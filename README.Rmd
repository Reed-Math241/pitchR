---
output: github_document
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "75%",
  warning = FALSE,
  message = FALSE,
  fig.retina = 2,
  fig.align = 'center'
)
library(tidyverse)
library(pitchR)
```


# pitchR  <img src= "https://github.com/Reed-Math241/pkgGrpq/blob/master/figs/IMG_0175.png" align="right" width=175 />


<!-- badges: start -->
<!-- badges: end -->


The goal of `pitchR` is to provide an accessible dataset with advanced pitching statistics and salary data for individual starting pitchers. This dataset contains data from the 2018, 2019, and 2020 seasons.

One exciting feature of the package is the inclusion of expected statistics!


```{r pitcher_woba-1, echo=FALSE, warning=FALSE, fig.width=14, fig.height=8}
pitcher <- pitchR %>%
  group_by(name) %>%
  summarize(
    ba = mean(ba),
    xba = mean(xba),
    salary = mean(salary)
    )

ggplot(data = pitcher, aes(x = ba, y = xba)) +
  geom_point(aes(color = salary), size = 5) +
  geom_abline(slope = 1, intercept = 0, alpha = 0.3, size = 3) +
  scale_color_gradient(low = "gray80", high = "turquoise4") +
  labs(
    title = "Batting Average vs Expected Batting Average by Pitcher",
    subtitle = "Batting Average: hits/# of at bats, expected values are derived by
comparing the exit velocity and launch angle of batted balls against historical outcomes",
    x = "Batting Average",
    y = "Expected Batting Average",
    color = "Salary"
    ) +
  theme_minimal() +
  theme(
    plot.title.position = "plot",
    plot.subtitle = element_text(margin = margin(10, 0, 20, 0), size = 19),
    plot.title = element_text(size = 25),
    axis.text = element_text(size = 19),
    axis.title = element_text(size = 19, margin = margin(10, 10, 16, 10)),
    legend.key.size = unit(2, "cm"),
    legend.text = element_text(size = 15),
    legend.title = element_text(size = 20)
    )

```

## Installation

The development version of `pitchR` is available from [GitHub](https://github.com/Reed-Math241/pkgGrpq) with:

``` r
# install.packages("devtools")
devtools::install_github("Reed-Math241/pkgDemo")
```

## About the Data

Data were collected and made available by [Spotrac](https://www.spotrac.com/mlb/payroll/) and the [Savant](https://baseballsavant.mlb.com/statcast_search). The full scraping and cleaning process is documented [here](https://github.com/Reed-Math241/pkgGrpq/blob/master/data-raw/DATASET.R).

The `pitchR` package contains one dataset, with 23 variables and 579 observations.

```{r showdata}
library(pitchR)
data('pitchR')
``` 

Here is a simplified version of the raw data; see `?pitchR` for more information: 

```{r example-pitchR}
head(pitchR)
```

Here's a breakdown of how much missing data we have by variable. We opted to keep observations with missing values in order to keep our full salary data.

```{r missing-data, echo=FALSE, fig.width=14, fig.height=8}
pitchR %>% 
  summarise(across(everything(), ~mean(!is.na(.)))) %>% 
  gather() %>% 
  mutate(key = fct_reorder(key, value)) %>% 
  ggplot(aes(key, value)) +
  geom_col(
    fill = "midnightblue",
    alpha = 0.8,
    color = NA
  ) +
  geom_text(
    aes(label = scales::percent(value)),
    nudge_y = 0.05,
    size = 14
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),
    axis.text.y = element_text(size = 19),
    axis.title = element_text(size = 19, margin = margin(10, 10, 16, 10)),
  ) +
  labs(
    x = "",
    y = "% of data present"
  ) +
  coord_flip()
```


## Examples

By virtue of `pitchR` having data from 3 different years, there is a lot of summarizing and comparing the data that can be done. For example:

```{r example, warning=FALSE, message=FALSE}
library(tidyverse)

pitchR %>% 
  count(year)

pitchR %>% 
  group_by(year) %>% 
  summarize(across(where(is.numeric), mean, na.rm = T))
```

We can visualize distributions by year!

```{r pitcher_velocity-1, echo=FALSE, fig.width=14, fig.height=8, include=FALSE}

ggplot(data = pitchR, aes(x = velocity, y = spin_rate)) +
  geom_point(
    aes(color = whiffs), 
    size = 4
    ) +
  scale_color_gradient(low = "cornsilk2", high = "turquoise4") +
  labs(
    title = "Velocity, Spin Rate, and Whiffs",
    subtitle = "Whiffs: Total Number of times a batter swung and whiffed on the player's pitch",
    x = "Velocity (MPH)",
    y = "Spin Rate (Revolutions per Min.)"
    ) +
  theme_minimal() +
  theme(
    plot.title.position = "plot",
    plot.subtitle = element_text(margin = margin(10, 0, 20, 0), size = 19),
    plot.title = element_text(size = 25),
    axis.text = element_text(size = 19),
    axis.title = element_text(size = 19, margin = margin(10, 10, 16, 10)),
    legend.key.size = unit(2, "cm"),
    legend.text = element_text(size = 15),
    legend.title = element_text(size = 20)
    )

```

```{r hist, fig.width=14, fig.height=8, echo=FALSE}
pitchR %>% 
  ggplot(aes(x = woba, fill = factor(year))) +
  geom_density(position = "identity", alpha = 0.5, color = NA) +
  scale_fill_manual(values = c("grey65", "midnightblue", "cyan4")) +
  theme_minimal() +
  labs(
    title = "woba distributions by year",
    fill = "Year"
  ) +
  theme(
    plot.title.position = "plot",
    plot.subtitle = element_text(margin = margin(10, 0, 20, 0), size = 19),
    plot.title = element_text(size = 25),
    axis.text = element_text(size = 19),
    axis.title = element_text(size = 19, margin = margin(10, 10, 16, 10)),
    legend.key.size = unit(2, "cm"),
    legend.text = element_text(size = 15),
    legend.title = element_text(size = 20)
  )
```







